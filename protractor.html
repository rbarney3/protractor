<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>4th Grade Angle Measurement Assessment</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #f5f7fa;
        margin: 0;
        overflow: hidden;
    }
    #container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
    }
    #protractor-container {
        position: absolute;
        top: 50px;
        left: 50px;
        width: 300px;
        user-select: none;
    }
    #protractor {
        width: 100%;
        display: block;
        pointer-events: none; /* so the handle works */
    }
    #rotate-handle {
        position: absolute;
        bottom: -15px;
        left: 50%;
        width: 20px;
        height: 20px;
        background: red;
        border-radius: 50%;
        cursor: grab;
        transform: translateX(-50%);
    }
    .arrow {
        position: absolute;
        top: 10px;
        font-size: 28px;
        cursor: pointer;
        padding: 5px 10px;
        background: rgba(255,255,255,0.8);
        border-radius: 5px;
        user-select: none;
    }
    #prev { left: 10px; }
    #next { left: 60px; }
    #question-area {
        position: absolute;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
    }
    #angleCanvas {
        border: 1px solid #ccc;
        background: white;
    }
    #answer {
        font-size: 18px;
        padding: 5px;
        width: 100px;
        text-align: center;
        margin-top: 10px;
    }
    #submit-btn {
        font-size: 20px;
        padding: 10px 20px;
        background: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
        margin-top: 20px;
        border-radius: 5px;
    }
    #result {
        margin-top: 20px;
        font-size: 20px;
        font-weight: bold;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

<div id="container">
    <div id="protractor-container">
        <img id="protractor" src="protractor1.png" alt="Protractor">
        <div id="rotate-handle"></div>
    </div>

    <div class="arrow" id="prev">⬅</div>
    <div class="arrow" id="next">➡</div>

    <div id="question-area">
        <h2 id="q-num"></h2>
        <canvas id="angleCanvas" width="400" height="300"></canvas>
        <div>
            <input type="number" id="answer" placeholder="Degrees">
        </div>
        <div id="submit-container"></div>
        <div id="result"></div>
    </div>
</div>

<script>
const questions = [35, 60, 90, 120, 150, 45, 75, 135, 25, 180];
let rotations = questions.map(() => Math.floor(Math.random() * 360));
let answers = Array(questions.length).fill('');
let currentQuestion = 0;

// --- Protractor Drag & Rotate ---
const container = document.getElementById('protractor-container');
const handle = document.getElementById('rotate-handle');
let dragging = false, rotating = false;
let offsetX, offsetY;
let startAngle, startMouseAngle;

container.addEventListener('mousedown', e => {
    if (e.target === handle) return; // don't drag if handle clicked
    dragging = true;
    offsetX = e.clientX - container.offsetLeft;
    offsetY = e.clientY - container.offsetTop;
});
document.addEventListener('mousemove', e => {
    if (dragging) {
        container.style.left = (e.clientX - offsetX) + 'px';
        container.style.top = (e.clientY - offsetY) + 'px';
    }
    if (rotating) {
        let centerX = container.offsetLeft + container.offsetWidth / 2;
        let centerY = container.offsetTop + container.offsetHeight / 2;
        let angle = Math.atan2(e.clientY - centerY, e.clientX - centerX) * 180 / Math.PI;
        let rotation = angle - startMouseAngle + startAngle;
        container.style.transform = `rotate(${rotation}deg)`;
    }
});
document.addEventListener('mouseup', () => { dragging = false; rotating = false; });

// Rotate
handle.addEventListener('mousedown', e => {
    e.stopPropagation();
    rotating = true;
    let centerX = container.offsetLeft + container.offsetWidth / 2;
    let centerY = container.offsetTop + container.offsetHeight / 2;
    startMouseAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX) * 180 / Math.PI;
    startAngle = getRotation(container);
    e.preventDefault();
});

function getRotation(el) {
    const st = window.getComputedStyle(el, null);
    const tr = st.getPropertyValue("transform");
    if (tr === "none") return 0;
    const values = tr.split('(')[1].split(')')[0].split(',');
    const a = values[0], b = values[1];
    const angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
    return angle;
}

// --- Drawing Angles ---
function drawAngleCanvas(angle, rotation) {
    const canvas = document.getElementById('angleCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = "black";
    ctx.lineWidth = 3;

    const centerX = canvas.width/2;
    const centerY = canvas.height/2;
    const length = 100;

    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.lineTo(centerX + length * Math.cos(rotation * Math.PI/180), centerY + length * Math.sin(rotation * Math.PI/180));
    ctx.moveTo(centerX, centerY);
    ctx.lineTo(centerX + length * Math.cos((rotation + angle) * Math.PI/180), centerY + length * Math.sin((rotation + angle) * Math.PI/180));
    ctx.stroke();
}

// --- Question Navigation ---
function showQuestion() {
    document.getElementById('q-num').textContent = `Question ${currentQuestion+1} of ${questions.length}`;
    drawAngleCanvas(questions[currentQuestion], rotations[currentQuestion]);
    document.getElementById('answer').value = answers[currentQuestion] || '';
    document.getElementById('submit-container').innerHTML = (currentQuestion === questions.length-1)
        ? '<button id="submit-btn">Submit</button>' : '';
    if (currentQuestion === questions.length-1) {
        document.getElementById('submit-btn').onclick = gradeAssessment;
    }
}

document.getElementById('prev').onclick = () => {
    if (currentQuestion > 0) {
        answers[currentQuestion] = document.getElementById('answer').value;
        currentQuestion--;
        showQuestion();
    }
};
document.getElementById('next').onclick = () => {
    if (currentQuestion < questions.length-1) {
        answers[currentQuestion] = document.getElementById('answer').value;
        currentQuestion++;
        showQuestion();
    }
};

function gradeAssessment() {
    answers[currentQuestion] = document.getElementById('answer').value;
    let score = 0;
    let feedback = '';
    for (let i=0; i<questions.length; i++) {
        let diff = Math.abs(parseInt(answers[i]) - questions[i]);
        if (diff <= 2) {
            score++;
            feedback += `Q${i+1}: ✅ Correct (${answers[i]}°)\n`;
        } else {
            feedback += `Q${i+1}: ❌ (${answers[i]}° — correct is ${questions[i]}°)\n`;
        }
    }
    document.getElementById('result').innerHTML = `Score: ${score} / ${questions.length}\n\n${feedback}`;
}

showQuestion();
</script>

</body>
</html>
